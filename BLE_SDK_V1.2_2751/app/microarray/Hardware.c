#include "Hardware.h"
#include "Front.h"
#include "m_flash.h"
#include "User.h"

//===========================硬件输入接口=======================================//
volatile HardwareInput_t g_hardware_input;         //全局硬件输入仿真结构

#if 0
//获取滑盖Touch状态
u32 SliderGetTouch(void)
{
    return g_hardware_input.slider_touch;
}
//获取滑盖开霍尔状态
u32 SliderGetHallOpened(void)
{
    return g_hardware_input.slider_hall_opened;
}
//获取滑盖关霍尔状态
u32 SliderGetHallClosed(void)
{
    return g_hardware_input.slider_hall_closed;
}
#endif
//获取前面板当前按键
KeyLed_t FrontGetKey(void)
{
    return g_hardware_input.key;
}
//获取设置键状态
u32 FrontGetConfigKey(void)
{
    return g_hardware_input.config_key;
}

u32 FrontGetKeyTouch(void)
{
		return g_hardware_input.key_touch;
	
}
//获取指纹触摸状态
u32 FrontGetFingerTouch(void)
{
    return g_hardware_input.finger_touch;
}
//获取匹配的指纹
s32 FrontGetMatchFinger(void)
{
    return g_hardware_input.finger;
}
//获取刷卡卡号
s32 FrontGetRfid(void)
{
    return g_hardware_input.rfid;
}

//===========================硬件输出接口=======================================//
const u8 logo_screen[SCREEN_BYTES] = {           //Logo屏幕显示(目前为"欢迎使用"字样)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,
    0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x80,0x00,
    0x00,0x00,0x80,0x80,0x80,0xC0,0x40,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
    0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x18,0x60,0xC0,0xE0,0xFF,0x0F,0x10,0x3F,
    0x0F,0x01,0x01,0xFD,0xFD,0x01,0x01,0x1D,0x0F,0x03,0x00,0x20,0x20,0x21,0xE3,0xE7,
    0x02,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x01,0x01,0x01,0xFF,0xFF,0x00,
    0x00,0xC0,0x20,0xFC,0xFF,0x03,0x00,0xF2,0xF2,0x12,0x12,0x12,0xFF,0xFF,0x12,0x12,
    0x12,0x12,0xF2,0xF2,0x02,0x00,0x00,0x00,0xFF,0xFF,0x20,0x20,0x20,0x20,0x20,0xFF,
    0xFF,0x20,0x20,0x20,0x20,0x20,0x20,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x60,0x30,0x1C,0x0F,0x07,0x0E,0xB8,0x90,0x40,
    0x60,0x38,0x1F,0x07,0x03,0x1E,0x38,0xE0,0x80,0x00,0x00,0x80,0xC0,0x60,0x7F,0x7F,
    0x80,0x80,0x0F,0x1F,0x0C,0x04,0x06,0x00,0x7F,0x7F,0x00,0x08,0x08,0x0F,0x07,0x00,
    0x00,0x00,0x00,0xFF,0xFF,0x00,0x80,0x81,0xC1,0x5D,0x79,0x31,0x3F,0x6F,0x41,0x41,
    0xC1,0x81,0x83,0x83,0x00,0x00,0x80,0xE0,0xFF,0x1F,0x08,0x08,0x08,0x08,0x08,0xFF,
    0xFF,0x08,0x08,0x08,0x08,0x08,0x08,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
    0x01,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
const u8 font_english[] = {
    0xF8,0xFC,0x04,0xC4,0x24,0xFC,0xF8,0x00,0x07,0x0F,0x09,0x08,0x08,0x0F,0x07,0x00,//"0"=0x00
    0x00,0x10,0x18,0xFC,0xFC,0x00,0x00,0x00,0x00,0x08,0x08,0x0F,0x0F,0x08,0x08,0x00,//"1"=0x01
    0x08,0x0C,0x84,0xC4,0x64,0x3C,0x18,0x00,0x0E,0x0F,0x09,0x08,0x08,0x0C,0x0C,0x00,//"2"=0x02
    0x08,0x0C,0x44,0x44,0x44,0xFC,0xB8,0x00,0x04,0x0C,0x08,0x08,0x08,0x0F,0x07,0x00,//"3"=0x03
    0xC0,0xE0,0xB0,0x98,0xFC,0xFC,0x80,0x00,0x00,0x00,0x00,0x08,0x0F,0x0F,0x08,0x00,//"4"=0x04
    0x7C,0x7C,0x44,0x44,0xC4,0xC4,0x84,0x00,0x04,0x0C,0x08,0x08,0x08,0x0F,0x07,0x00,//"5"=0x05
    0xF0,0xF8,0x4C,0x44,0x44,0xC0,0x80,0x00,0x07,0x0F,0x08,0x08,0x08,0x0F,0x07,0x00,//"6"=0x06
    0x0C,0x0C,0x04,0x84,0xC4,0x7C,0x3C,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00,//"7"=0x07
    0xB8,0xFC,0x44,0x44,0x44,0xFC,0xB8,0x00,0x07,0x0F,0x08,0x08,0x08,0x0F,0x07,0x00,//"8"=0x08
    0x38,0x7C,0x44,0x44,0x44,0xFC,0xF8,0x00,0x00,0x08,0x08,0x08,0x0C,0x07,0x03,0x00,//"9"=0x09
    0x80,0xA0,0xE0,0xC0,0xC0,0xE0,0xA0,0x80,0x00,0x02,0x03,0x01,0x01,0x03,0x02,0x00,//"*"=0x0a
    0x20,0xF8,0xF8,0x20,0xF8,0xF8,0x20,0x00,0x02,0x0F,0x0F,0x02,0x0F,0x0F,0x02,0x00,//"#"=0x0b
    0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//"-"=0x0c
    0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x06,0x00,0x00,0x00,//":"=0x0d
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//" "=0x0e
};
const u8 font_chinese[] = {
    0x20,0x22,0xEC,0x00,0x20,0x22,0xAA,0xAA,0xAA,0xBF,0xAA,0xAA,0xEB,0xA2,0x20,0x00,
    0x00,0x00,0x7F,0x20,0x10,0x00,0xFF,0x0A,0x0A,0x0A,0x4A,0x8A,0x7F,0x00,0x00,0x00,//"请"=0x80
    0x88,0x68,0x1F,0xC8,0x0C,0x28,0x90,0xA8,0xA6,0xA1,0x26,0x28,0x10,0xB0,0x10,0x00,
    0x09,0x09,0x05,0xFF,0x05,0x00,0xFF,0x0A,0x8A,0xFF,0x00,0x1F,0x80,0xFF,0x00,0x00,//"输"=0x81
    0x00,0x00,0x00,0x00,0x00,0x01,0xE2,0x1C,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x80,0x40,0x20,0x10,0x0C,0x03,0x00,0x00,0x00,0x03,0x0C,0x30,0x40,0xC0,0x40,0x00,//"入"=0x82
    0x10,0x4C,0x24,0x04,0xF4,0x84,0x4D,0x56,0x24,0x24,0x14,0x84,0x24,0x54,0x0C,0x00,
    0x00,0x01,0xFD,0x41,0x40,0x41,0x41,0x7F,0x41,0x41,0x41,0x41,0xFC,0x00,0x00,0x00,//"密"=0x83
    0x02,0x82,0xF2,0x4E,0x43,0xE2,0x42,0xFA,0x02,0x02,0x02,0xFF,0x02,0x80,0x00,0x00,
    0x01,0x00,0x7F,0x20,0x20,0x7F,0x08,0x09,0x09,0x09,0x0D,0x49,0x81,0x7F,0x01,0x00,//"码"=0x84
    0x10,0x10,0x10,0xFF,0x90,0x50,0x00,0x3F,0x48,0x48,0x48,0x44,0x46,0xC4,0x70,0x00,
    0x02,0x42,0x81,0x7F,0x00,0x00,0x00,0xFF,0x49,0x49,0x49,0x49,0x49,0xFF,0x01,0x00,//"指"=0x85
    0x20,0x30,0xAC,0x63,0x30,0x10,0x30,0xD0,0x11,0x16,0x10,0xD0,0x30,0x18,0x10,0x00,
    0x22,0x63,0x22,0x12,0x12,0x92,0x40,0x20,0x1B,0x04,0x1B,0x20,0x40,0xC0,0x40,0x00,//"纹"=0x86
    0x40,0x40,0x40,0x40,0x40,0x40,0xFF,0x44,0x44,0x44,0x46,0x44,0x40,0x60,0x40,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x02,0x04,0x0C,0x18,0x00,0x00,0x00,0x00,//"卡"=0x87
    0x80,0x80,0x80,0xBE,0xA2,0xA2,0xA2,0xA2,0xA2,0xA2,0xA2,0xBF,0x82,0xC0,0x80,0x00,
    0x00,0x00,0x00,0x04,0x06,0x05,0x04,0x04,0x44,0x84,0x44,0x3E,0x04,0x00,0x00,0x00,//"号"=0x88
    0x40,0x42,0x44,0xCC,0x00,0x00,0xFF,0x49,0x49,0x49,0x49,0x49,0xFF,0x40,0x00,0x00,
    0x00,0x40,0x20,0x1F,0x20,0x40,0x9F,0x88,0x85,0x81,0x82,0x85,0x88,0xD8,0x40,0x00,//"退"=0x89
    0x00,0x00,0xFC,0x40,0x40,0x40,0x40,0xFF,0x40,0x40,0x40,0x40,0xFC,0x00,0x00,0x00,
    0x00,0xFE,0x40,0x40,0x40,0x40,0x40,0x7F,0x40,0x40,0x40,0x40,0x40,0xFE,0x00,0x00,//"出"=0x8a
    0x04,0x84,0xE4,0x9C,0x84,0xC6,0x24,0xF0,0x28,0x27,0xF4,0x2C,0x24,0xF0,0x20,0x00,
    0x01,0x00,0x7F,0x20,0x20,0xBF,0x40,0x3F,0x09,0x09,0x7F,0x09,0x89,0xFF,0x00,0x00,//"确"=0x8b
    0x10,0x0C,0x04,0x24,0x24,0x24,0x25,0xE6,0x24,0x24,0x34,0x24,0x04,0x14,0x0C,0x00,
    0x80,0x40,0x20,0x1F,0x20,0x40,0x40,0x7F,0x42,0x42,0x43,0x42,0x40,0x60,0x20,0x00,//"定"=0x8c
    0x02,0xFA,0x02,0x02,0xFF,0x42,0x20,0x50,0x4C,0x43,0x4C,0x50,0x20,0x60,0x20,0x00,
    0x10,0x31,0x11,0x49,0x89,0x7F,0x42,0x5C,0x40,0x4F,0x60,0x58,0x47,0x60,0x40,0x00,//"验"=0x8d
    0x20,0x20,0x21,0xE6,0x00,0x02,0x02,0xC2,0x02,0x02,0xFE,0x82,0x82,0xC3,0x82,0x00,
    0x00,0x00,0x00,0x7F,0x20,0x50,0x40,0x7F,0x40,0x40,0x7F,0x40,0x40,0x60,0x40,0x00,//"证"=0x8e
    0x80,0x68,0x24,0xA3,0xA6,0xAA,0xA2,0xBA,0xA4,0xA3,0xA2,0xA6,0x2A,0xA2,0x60,0x00,
    0x00,0x00,0x00,0xFF,0x4A,0x4A,0x4A,0x4A,0x4A,0x4A,0x4A,0x7B,0x00,0x00,0x00,0x00,//"管"=0x8f
    0x44,0x44,0xFC,0x46,0x44,0x00,0xFE,0x92,0x92,0xFE,0x92,0x92,0xFF,0x02,0x00,0x00,
    0x10,0x30,0x1F,0x08,0x48,0x48,0x44,0x44,0x44,0x7F,0x44,0x46,0x44,0x60,0x40,0x00,//"理"=0x90
    0x00,0x00,0xC0,0x5E,0x52,0x52,0x52,0x52,0x52,0x52,0x52,0x5F,0xE2,0x40,0x00,0x00,
    0x00,0x80,0x9F,0x40,0x40,0x20,0x10,0x0F,0x00,0x20,0x20,0x40,0x5F,0x80,0x00,0x00,//"员"=0x91
};
HardwareOutput_t g_hardware_output;       //全局硬件输出仿真结构

#if 0
//设置滑盖电机
void SliderSetMoto(u32 moto)
{
    g_hardware_output.slider_moto = moto;
}
#endif
//播放语音
void VoicePlay(Voice_t voice)
{
    g_hardware_output.voice = voice;
}
//点亮LED
void FrontSetLedOn(u32 leds)
{
    g_hardware_output.led |= leds;
}
//熄灭LED
void FrontSetLedOff(u32 leds)
{
    g_hardware_output.led &= ~leds;
}
//设置指纹LED亮灭
void FingerSetLed(u32 on_off)
{
    g_hardware_output.finger_led = on_off;
}
//清屏
void ScreenClear(void)
{
    //memset(g_hardware_output.screen, 0, SCREEN_BYTES);
}
//屏显示Logo
void ScreenShowLogo(void)
{
    //memcpy(g_hardware_output.screen, logo_screen, SCREEN_BYTES);
}
#if 0
//打印屏上0~3行之一,每次打印整行
void ScreenPrintLine(u8 line, u8 *str)
{
    u8 *data = g_hardware_output.screen + line * 256;
    u8 pos, ch;
    for(pos = 0; pos < 128;){
        ch = *str;
        if (ch & 0x80){//汉字
            memcpy(data, &font_chinese[(ch - 0x80) * 32], 16);
            memcpy(data + 128, &font_chinese[(ch - 0x80) * 32] + 16, 16);
            data += 16;
            pos += 16;
        }else{//英文
            memcpy(data, &font_english[ch * 16], 8);
            memcpy(data + 128, &font_english[ch * 16] + 8, 8);
            data += 8;
            pos += 8;
        }
        str++;
    }
}

//===========================硬件内部接口=======================================//
HardwareInner_t g_hardware_inner;         //全局硬件内部仿真结构

//获取时间戳
u32 FrontGetStamp(void)
{
    return g_hardware_inner.tick;
}
//获取当前与时间戳的间隔时间
u32 FrontCalcElapsed(u32 stamp)
{
    return (g_hardware_inner.tick - stamp);
}

typedef struct{
    u32 minute : 7;
    u32 hour   : 5;
    u32 day    : 5;
    u32 month  : 4;
    u32 year   : 11;
}DateTime_t;
//获取日期时间
u32 FrontGetDatetime(void)
{
    qint64 sec = g_hardware_inner.dt_start.secsTo(QDateTime::currentDateTime());
    QDateTime rtc = g_hardware_inner.dt_base.addSecs(sec);
    DateTime_t dt;
    dt.year = rtc.date().year() - 2000;
    dt.month = rtc.date().month();
    dt.day = rtc.date().day();
    dt.hour = rtc.time().hour();
    dt.minute = rtc.time().minute();

    return *((u32*)(&dt));
}
//设置日期时间
void FrontSetDatetime(u32 dt)
{
    DateTime_t *datetime = (DateTime_t *)(&dt);
    QDate date(datetime->year + 2000, datetime->month, datetime->day);
    QTime time(datetime->hour, datetime->minute);
    g_hardware_inner.dt_base.setDate(date);
    g_hardware_inner.dt_base.setTime(time);
    g_hardware_inner.dt_start = QDateTime::currentDateTime();
}
//将日期时间转化为字符串
void FrontDatetimeToLine(u32 dt, u8 *str)
{
    u32 t;
    DateTime_t *datetime = (DateTime_t *)(&dt);
    t = datetime->year + 2000;
    str[0] = t / 1000; t %= 1000;                //'0'~'9'=0x00・0x09
    str[1] = t / 100;  t %= 100;
    str[2] = t / 10;   t %= 10;
    str[3] = t;
    str[4] = 0x0c;                               //'-'=0x0c
    t = datetime->month;
    str[5] = t / 10;   t %= 10;
    str[6] = t;
    str[7] = 0x0c;
    t = datetime->day;
    str[8] = t / 10;   t %= 10;
    str[9] = t;
    str[10] = 0x0e;                              //' '=0x0e
    t = datetime->hour;
    str[11] = t / 10;  t %= 10;
    str[12] = t;
    str[13] = 0x0d;                              //':'=0x0d
    t = datetime->minute;
    str[14] = t / 10;  t %= 10;
    str[15] = t;
}
#endif

void HardwareInputInit(void)
{
		//init board state
    g_hardware_input.key = KEY_LED_NONE;
    g_hardware_input.finger_touch = 0;
	  g_hardware_input.key_touch = 0;
    g_hardware_input.finger = -1;
    g_hardware_input.rfid = -1;
	  g_hardware_output.led = 0;
    g_hardware_output.finger_led = 0;
	  FrontInit();
}



void HardwareOutputTask(void)
{
	
}



Timeout gtTimeout_M;


void GetStartTime_M(uint32_t timeover)
{
		gtTimeout_M.start_time =  systemTick();
	  gtTimeout_M.time_over  = timeover;
	  gtTimeout_M.time_over_flag = 0;
}

uint8_t GetCurrentTimeCnt_M(void)
{
	  uint32_t temptime;
		gtTimeout_M.end_time = systemTick();
	  if(gtTimeout_M.end_time >= gtTimeout_M.start_time)
		{
			 temptime =  gtTimeout_M.end_time - gtTimeout_M.start_time;
		}
		else
		{
			 temptime = 0xFFFFFFFF - gtTimeout_M.start_time + gtTimeout_M.end_time;
		}
		if(temptime >= gtTimeout_M.time_over)
		{
			 gtTimeout_M.time_over_flag = 1;
		}
		return gtTimeout_M.time_over_flag;
}
